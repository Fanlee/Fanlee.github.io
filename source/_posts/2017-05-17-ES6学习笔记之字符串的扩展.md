---
title: ES6学习笔记之字符串的扩展
date: 2017-05-17
categories: 学习笔记
tags: ES6
keywords: ES6
comments: true

---
## ES5中字符串的属性和方法
### length
Sting类型的每个实例都有一个`length`的属性，表示字符串包含多少个字符。
```
let stringValue = 'hello';
console.log(stringValue.length) // 5
```
### charAt()和charCodeAt()
用于访问字符串中特定的字符，两个方法都接受一个参数，即字符所在的下标位置。其中`charAt()`方法返回下标所在的字符，而`charCodeAt()`则返回下标对应的字符的字符编码。
```
let str = 'hello';
console.log(str.charAt(1)); // e
console.log(str.charCodeAt(1)); // 101
```
还可以通过方括号加下标直接取到对应字符
```
let str = 'hello';
console.log(str[1]); // e
```
### concat()
用于将多个字符拼接起来，返回拼接得到的新字符，不会修改字符串本身的值。
```
let str = "hello";
let result = str.concat(" world","!");
console.log(result) //hello world!
```
但是实际应用中还是用“+”操作符更方便。
### slice()、substr()、substring()
这三个方法都会返回被操作字符串的一个子字符串，而且也都接受一或两个参数。第一个参数指定子字符串开始的位置，第二个参数表示子字符串到哪里结束。`slice()`和`substring()`的第二个参数指定子字符串最后一个字符的位置(不包含字符本身)。而`substr()`的第二个参数指定的则是返回的字符个数。如果不给这些方法指定第二个参数，则将字符串的长度作为结束位置。它们都不会修改字符串本身的值。
```
let str = "hello world";
console.log(str.slice(3)); // lo world
console.log(str.substr(3)); // lo world
console.log(str.substring(3)); // lo world

console.log(str.slice(3, 7)); // lo w
console.log(str.substr(3, 7)); // lo worl
console.log(str.substring(3, 7)); // lo w
```
如果传递给这些方法的参数是负值，结果就不相同了。

 1. `slice()`方法会将传入的负值与字符串的长度相加。
 2. `substr()`将负的第一个参数加上字符串的长度，将负的第二个参数转换为0。
 3. `substring()`方法会将所有的负的参数转换为0。
```
let str = "hello world";
console.log(str.slice(-3)); // rld
console.log(str.substr(-3)); // rld
console.log(str.substring(-3)); // hello world

console.log(str.slice(3, -4)); // lo w
console.log(str.substr(3, -4)); // (空字符串)
console.log(str.substring(3, -4)); // hel
```
**注意:**`substring()`这个方法始终会将较小的数作为开始位置，较大的数作为结束位置。

### indexOf()和lastIndexOf()
两个方法都是从字符串中搜索给定的子字符串，然后返回字符串的位置。如果没有找到就返回-1。`indexOf()`从字符串的开头向后进行搜索，而`lastIndexOf()`与之相反。
```
let str = "hello world";
console.log(str.indexOf('o')); // 4
console.log(str.lastIndexOf('o')); // 7
```
这两个方法都可以接受第二个参数，指定搜索的起始位置。
```
let str = "hello world";
console.log(str.indexOf('o', 6)); // 7
console.log(str.lastIndexOf('o', 6)); // 4
```
搜索字符串中所有匹配的字符
```
let str = "hello world hello world hello world hello world";
let arr = [];
let pos = str.indexOf("o");
while ( pos > -1){
  arr.push(pos);
  pos = str.indexOf("o", pos+1);
}
```
### trim()
这个方法会创建一个字符串的副本，删除前置及后缀的空格，返回结果，不会修改原始字符串。
```
let str = " hello world ";
console.log(str.trim()); // "hello world"
```
### toLowerCase()、toLocaleLowerCase()、toUpperCase()和toLocaleUpperCase()
常用的是`toLowerCase()`和`toUpperCase()`,`toLocaleLowerCase()`和`toLocaleUpperCase()`是针对特定的地区实现的。
`toUpperCase()`小写转大写，`toLowerCase()`大写转小写。
```
let str = "HELLO WORLD";
console.log(str.toLowerCase()); // "hello wprld"

let str = "hello wprld";
console.log(str.toLowerCase()); // "HELLO WORLD"
```
### match()
在字符串上调用这个方法，本质上与调用`RegExp`的`exec()`方法相同，`match()`方法只接受一个参数，要么是一个正则表达式，要么是一个`RegExp`对象。
```
let text = "cat, bat, sat, fat";
let pattern = /.at/;
let matchs = text.match(pattern);
console.log(matchs) // ["cat", index: 0, input: "cat, bat, sat, fat"]
```
### search()
这个方法唯一参数与`match()`参数相同，`search()`方法返回字符串第一个匹配项的索引，如果没有找到匹配项，则返回`-1`。
```
let text = "cat, bat, sat, fat";
var pos = text.search(/at/);
console.log(pos) // 1
```
### replace()
这个方法接受两个参数：第一个参数可以是一个RegExp对象或者一个字符串，第二个参数可以是一个字符串或者一个函数。如果第一个参数是一个字符串，就只会替换第一个字符串，如果要替换所有的字符串，就必须要用正则表达式，全局(g)替换。
```
let text = "cat, bat, sat, fat";
var result = text.replace("at", "fu");
console.log(result); // "cfu, bat, sat, fat"

let text = "cat, bat, sat, fat";
var result = text.replace(/at/g, "fu");
console.log(result); // "cfu, bfu, sfu, ffu"
```
`replace()`的第二个方法可以是一个函数，在只有一个匹配项的情况下，会向这个函数传递三个参数：模式的匹配项，模式的匹配项在字符串中的位置和原始字符串。
```
let text = "<p class=\"active\">Hello world</p>";
let result = text.replace(/[<>"&]/g, function (match, pos, oldText) {
  switch (match) {
    case "<" :
      return "&lt;";
    case ">" :
      return "&gt;";
    case  "&" :
      return "&amp;";
    case "\"" :
      return "&quot;";
  }
});
console.log(result) // "&lt;p class=&quot;active&quot;&gt;Hello world&lt;/p&gt;"
```
### split()
这个方法可以基于指定的分隔符把一个字符串分割成多个子字符串，并将结果放在一个数组里面。分隔符可以是字符串，也可以是RegExp对象。`split()`方法可以接受可选的第二个参数，用于指定数组的大小。
```
let color = "red, yellow, green, pink";
let color1 = color.split(","); // ["red", " yellow", " green", " pink"]
let color2 = color.split(",", 2); // ["red", " yellow"]
```
### localeCompare()
这个方法用于比较两个字符串，并返回下列结果之一:

 1. 如果字符串在字母表中位置在参数之前，则返回一个负数
 2. 字符串等于参数，返回0
 3. 如果字符串在字母表中位置在参数之后，返回一个正数

```
let str = "yellow";
console.log(str.localeCompare("black")); // 1
console.log(str.localeCompare("yellow")); // 0
console.log(str.localeCompare("zoom")); // -1
```
**注意:**`localeCompare()`返回的数值取决于实现，不一定是1， -1， 0。

### String.fromCharCode()
这个方法是接收一个或多个字符编码，然后转换成字符串。
```
console.log(String.fromCharCode(104, 101, 108, 108, 111)); // hello
```


----------
## ES6字符串的扩展
javascript允许采用`\uxxxx`表示一个字符，但是只限于码点在`\u0000`~`\uFFFF`之间，超出这个范围的字符就必须用双字节表示。
```
console.log("\uD842\uDFB7"); // "𠮷"
console.log("\u20BB7"); // " 7"
```
但是ES6只要将码点放入大括号中， 就能正确解读。
```
console.log("\u{20BB7}"); // "𠮷"
```

### codePointAt()
`codePointAt()`方法能够正确处理四个字节的字符（Unicode码点大于`0xFFFF`的字符），返回一个字符的码点（十进制）。
```
let str = '𠮷a';
console.log(str.codePointAt(0).toString(16)); // "20bb7"
console.log(str.codePointAt(1)); // "dfb7"
console.log(str.codePointAt(2)); // "61"
```
可以看出`codePointAt()`的参数任然是不对的，要取到`a`必须的传入2才能取到，要解决这种问题可以用`for...of`循环实现，因为它会正确识别32位的UTF-16字符。
```
let str = '𠮷a';
for(let c of str){
  console.log(c.codePointAt(0).toString(16)); //"20bb7" "61"
}
```
`codePointAt()`是判断一个字符是由两字节组成还是四字节组成最简单的办法。
```
function isBit(value){
  return value.codePointAt(0) > 0xFFFF;
}
console.log(isBit("𠮷")); // true
console.log(isBit("a")); // false
```
### String.fromCodePoint()
用于从码点返回对应字符，能够识别Unicode编号大于`0xFFFF`的字符。
```
String.fromCodePoint(0x20BB7) // "𠮷"
```
###字符串的遍历接口
ES6新增字符串遍历接口，字符串可以用`for...of`循环遍历。
```
let str = "hello";
for(let s of str){
  console.log(s) // "h" "e" "l" "l" "o"
}
```
这个遍历器最大的优点是可以识别大于0xFFFF的码点，传统的for循环无法识别这样的码点。
```
let str = "𠮷";
for(let i = 0; i < str.length; i++){
  console.log(str[i]) // � � (打印出来是这种无法识别的符号)
}

for(let s of str){
 console.log(s) // "𠮷"
}
```
### includes()、startsWith()、endsWith()

 1. `includes()`：返回布尔值，表示是否找到了参数字符串
 2. `startsWith()`：返回布尔值，表示参数字符串是否在源字符串头部
 3. `endsWith()`：返回布尔值，表示参数字符串是否在源字符串尾部
```
let str = "hello world!";
console.log(str.includes("hello")); // true
console.log(str.startsWith("hello")); // true
console.log(str.endsWith("!")); // true
```
这三个方法都可以接受第二个参数，`endsWith`的行为与其他两个方法有所不同。它针对前`n`个字符，而其他两个方法针对从第`n`个位置直到字符串结束。
```
 let str = "hello world!";
console.log(str.includes("world", 6))
console.log(str.startsWith("world", 6 ))
console.log(str.endsWith("hello", 5))
```
### repeat()
这个方法接收一个参数，表示要将原字符重复的次数。
```
let str = "abc";
console.log( str.repeat(3)) // "abcabcabc"
console.log( str.repeat(0)) // ""
```
如果参数不是正整数，则有下面几种情况：
 1. 如果参数是小数，会被取整
 2. 如果是负数或者是Infinity，会报错
 3. 如果是0~-1之间的小数，则为0
 4. 如果是NaN，则为0
 5. 如果是字符串，则会先转换成数字

### padStart()和padEnd()
字符串自动补全功能，如果字符串不够长度，会在头部或者尾部补全。这两个方法都可接收两个参数，第一个参数指定字符串的最小长度，第二个参数则是用来补全的字符串。
```
console.log( 'x'.padStart(5, 'ab')); // "ababx"
console.log( 'x'.padStart(4, 'ab')) // "abax"

console.log( 'x'.padEnd(5, 'ab')); // "xabab"
console.log( 'x'.padEnd(4, 'ab')); // "xaba"
```
当原字符串的长度大于指定的最小长度的时候，返回原字符串本身。
```
console.log( 'xxxxxxx'.padStart(5, 'ab')); // "xxxxxxx"
```
如果用来补全的字符串与原字符串长度的和大于指定的最小长度的时候，则会截取超出指定的最小长度的字符。
```
console.log( 'xxx'.padStart(10, '0123456789')); // "0123456xxx"
```
如果省略第二个参数，默认使用空格补全长度。
```
'x'.padStart(4) // '   x'
'x'.padEnd(4) // 'x   '
```
padStart的常见用途是为数值补全指定位数。下面代码生成10位的数值字符串。
```
'1'.padStart(10, '0') // "0000000001"
```
另一个用途是提示字符串格式。
```
'12'.padStart(10, 'YYYY-MM-DD') // "YYYY-MM-12"
'09-12'.padStart(10, 'YYYY-MM-DD') // "YYYY-09-12"
```
### 模板字符串
模板字符串（template string）是增强版的字符串，用反引号（`）标识。它可以当作普通字符串使用，也可以用来定义多行字符串，或者在字符串中嵌入变量。
```
// 普通字符串
`hello world!`;
//多行字符串
`How are you
I'm fine`
//字符串中嵌入变量
let name="Tom";
let age = 20;
`my name is ${name},  I'm ${age} years old`;
```
模板中使用多行字符串，空格和缩进会保留在输出之中。
```
 let str = `
  <ul>
    <li>first</li>
    <li>second</li>
  <ul>
`;
console.log(str)
```
效果图如下
![mark](http://optwq0urg.bkt.clouddn.com/blog/20170517/143957231.png?imageslim)

模板字符串中嵌入变量，需要将变量名写在`${}`中。大括号内可以放任意的JavaScript表达式
```
let x = 1,
    y = 2;
`${x} + ${y} = ${x + y}` // "1 + 2 = 3"

let obj = {x : 1, y : 2};
`${obj.x} + ${obj.y} = ${obj.x + obj.y}` // "1 + 2 = 3"

function fn(){
  return "hello world";
}
`Hi, ${fn()}` // "Hi, hello world"
```
模板字符串中的变量没有声明，就会报错。
```
`hello, ${text}` // Uncaught ReferenceError: text is not defined
```
模板字符串的大括号内部是一个字符串，将会原样输出。
```
`hello, ${'world'}` // "hello, world"
```
### 标签模板
模板字符串可以紧跟在一个函数名后面，该函数将被调用来处理这个模板字符串。如果模板字符串里面有变量，就会将模板字符串先处理成多个参数，再调用函数。
```
let a = 5;
let b = 10;

tag`Hello ${ a + b } world ${ a * b }`;
function tag(arr, value1, value2){
  console.log(arr); //  ["Hello ", " world ", "", raw: Array(3)]
  console.log(value1); // 15
  console.log(value2); // 50
}
```
`tag`函数的第一个参数是一个数组，该数组的成员是模板字符串中那些没有变量替换的部分。其他参数，都是模板字符串各个变量被替换后的值。

### String.raw()
`String.raw`方法，往往用来充当模板字符串的处理函数，返回一个斜杠都被转义（即斜杠前面再加一个斜杠）的字符串，对应于替换变量后的模板字符串。
```
console.log(String.raw`Hi\n${2+3}!` === "Hi\\n5!") // true
```
如果原字符串的斜杠已经转义，那么`String.raw`不会做任何处理。
```
console.log(String.raw`Hi\\n${2+3}!`) // "Hi\\n5!"
```
`String.raw`方法也可以作为正常的函数使用。这时，它的第一个参数，应该是一个具有`raw`属性的对象，且`raw`属性的值应该是一个数组。
```
String.raw({ raw: 'test' }, 0, 1, 2);
// 't0e1s2t'

// 等同于
String.raw({ raw: ['t','e','s','t'] }, 0, 1, 2);
```

